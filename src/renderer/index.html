<!DOCTYPE html>
<html lang="en" data-theme="corporate">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../../public/output.css">
    <title>e-Manifest Data Upload</title>
</head>

<body class="bg-base-200 min-h-dvh">
    <header>
        <div class="navbar sticky top-0 z-10 bg-primary text-primary-content border-b border-gray-300 min-h-0 h-16">
            <div class="flex-1 ml-4">
                <div>
                    <span class="text-base md:text-lg font-bold">e-Manifest</span>
                    <span class="text-xs font-bold ml-1">Data Upload</span>
                </div>
            </div>
            <div class="flex-1">
                <div class="flex">
                    <span class="badge badge-secondary text-xs" id="environment"></span>
                    <div class="tooltip tooltip-bottom" id="envTooltip" data-tip=""><span id="envIcon"></span></div>
                </div>
            </div>
            <nav>
                <div class="flex-none">
                    <ul class="menu menu-horizontal px-1">
                        <li>
                            <button class="btn btn-ghost" popovertarget="popover-1"
                                style="anchor-name:--anchor-1">Environment</button>
                            <ul class="dropdown menu bg-base-100 rounded-box shadow-sm w-50" popover id="popover-1"
                                style="position-anchor:--anchor-1">
                                <li id="devMenuItem" class="text-base-content hidden"><a id="changeDev"
                                        tabindex="0">Development</a></li>
                                <li class="text-base-content"><a id="changePreProd" tabindex="0">Pre-Production</a></li>
                                <li class="text-base-content"><a id="changeProd" tabindex="0">Production</a></li>
                            </ul>
                        </li>
                        <li><button id="apiSettingsBtn" class="btn btn-ghost">API Settings</button></li>
                        <li><button title="Help" onclick="helpModal.showModal()" class="btn btn-ghost" aria-label="Help"><svg
                                    xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                    stroke-width="1.5" stroke="currentColor" class="size-6">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z" />
                                </svg>
                            </button></li>
                    </ul>
                </div>
            </nav>
        </div>
    </header>
    <main>
        <div class="ml-12 mr-12 pb-6">
            <div class="mt-2 bg-base-100 p-6 rounded-sm">
                <h1 class="font-bold text-lg">e-Manifest Data Upload</h1>
                <p>This application uploads data from a Microsoft Excel workbook to EPA's e-Manifest system. You can
                    create
                    multiple electronic manifests in the same batch using data exported from your own system or
                    database. Once the manifests are created, they can be viewed, edited and signed in RCRAInfo via the e-Manifest module.
                    Click on the help icon above to get started.
                </p>
            </div>
            <div class="mt-2 bg-base-100 p-6 rounded-sm" id="allDataDiv">
                <h2 class="font-bold">Manifest Data</h2>
                <div role="alert" class="alert alert-info mt-2">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                        class="h-6 w-6 shrink-0 stroke-current">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <div>Download the Excel (XLSX) template and ensure provided data meets the specifications available
                        on
                        <span class="gh-link link  inline-flex items-center"><span>GitHub </span>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="size-4">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
                            </svg>
                        </span>
                    </div>
                </div>
                <div class="flex mt-3 mb-3">

                    <div class="flex-none">
                        <button class="btn btn-secondary btn-sm mr-2" id="selectExcelBtn">Select XLSX File</button>
                    </div>
                    <div class="flex-1"><span id="fileNameExcel">No file selected</span></div>
                </div>
                <div class="divider"></div>
                <div class="mt-3">
                    <button class="btn btn-primary" id="submitAllBtn">Submit Data</button>
                </div>
            </div>
            <div id="fullReport" class="mt-2 bg-base-100 p-6 rounded-sm break-words">
                <div>
                    <h2 class="font-bold">Full Report from e-Manifest</h2>
                    <div id="reportOutput" class="mt-2 mx-4"></div>
                </div>
            </div>
        </div>

        <div id="loading" class="hidden fixed inset-0 z-50">
            <div class="absolute inset-0 bg-white/10 backdrop-blur-sm"></div>
            <div class="absolute inset-0 flex items-center justify-center">
                <span class="mr-2 font-bold">Validating and submitting data</span> <span
                    class="loading loading-spinner loading-xl text-primary"></span>
            </div>
        </div>
    </main>

    <!---------------MODALS------------------------>

    <!--API Settings modal-->
    <dialog id="apiModal" class="modal">
        <div class="modal-box relative">
            <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2" onclick="apiModal.close()">✕</button>
            <h2 class="text-lg font-bold mb-5" id="exampleModalLabel">API Settings for <span id="envApi"></span>
            </h2>
            <div role="alert" class="alert alert-info">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                    class="h-6 w-6 shrink-0 stroke-current">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span>To generate or manage API credentials, go to <a class="link" href="#" id="apiLink"></a>
                </span>
            </div>
            <div class="form-control w-full max-w-xs">
                <label class="label" for="apiId">API ID</label>
                <input type="password" id="apiId" class="input input-md" />
            </div>
            <div class="form-control w-full max-w-xs">
                <label class="label" for="apiKey">API Key</label>
                <input type="password" id="apiKey" class="input input-md" />
            </div>
            <button class="btn btn-sm mt-4" id="viewCredsBtn">Show Credentials</button>
            <div class="modal-action">
                <button type="button" class="btn" onclick="apiModal.close()">Close</button>
                <button type="button" id="saveApiBtn" class="btn btn-primary">Save changes</button>
            </div>

        </div>
    </dialog>
    <!--e-Manifest API results modal-->
    <dialog id="apiSubmissionResultsModal" class="modal">
        <div class="modal-box relative">
            <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2"
                onclick="apiSubmissionResultsModal.close()" id="closeResults">✕</button>
            <div class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-10 h-10 text-success">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M10.125 2.25h-4.5c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125v-9M10.125 2.25h.375a9 9 0 0 1 9 9v.375M10.125 2.25A3.375 3.375 0 0 1 13.5 5.625v1.5c0 .621.504 1.125 1.125 1.125h1.5a3.375 3.375 0 0 1 3.375 3.375M9 15l2.25 2.25L15 12" />
                </svg>
                <h2 class="ml-1 font-bold text-lg">Manifest Submission Results</h2>
            </div>
            <div class="flex flex-wrap justify-center gap-4 my-3">
                <div class="font-bold">Saved: <span class="badge badge-success" id="badgeSaved"></span>
                </div>
                <div class="font-bold">Failed: <span class="badge badge-error" id="badgeFailed"></span>
                </div>
                <div class="font-bold">Total: <span class="badge badge-secondary" id="badgeTotal"></span>
                </div>
            </div>
            <div class="mt-1">
                <p>Below are the manifest tracking numbers and associated manifestId values for each manifest that
                    saved. </p>
                <p id="mtnsByid"></p>
                <br>
                <p>To see a full report for your manifests, including errors and warnings, close this popup and see the
                    "Full Report
                    from e-Manifest" section at the bottom of the page.
                </p>
            </div>
            <div class="modal-action">
                <button type="button" class="btn" onclick="apiSubmissionResultsModal.close()">Close</button>
            </div>
    </dialog>
    <!--File validation modal-->
    <dialog id="errorModal" class="modal">
        <div class="modal-box w-11/12 max-w-5xl items-start justify-center mt-8 break-words">
            <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2"
                onclick="errorModal.close()">✕</button>
            <div class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-10 h-10 text-error">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
                </svg>
                <h2 id="errorModalTitle" class="ml-1 font-bold text-lg">Error Creating Manifest</h2>
            </div>
            <div>
                <div role="alert" class="alert alert-info">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                        class="h-6 w-6 shrink-0 stroke-current">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>To learn more about error messages and how to resolve them go to
                        <span class="gh-link link  inline-flex items-center"><span>GitHub </span>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="size-4">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
                            </svg>
                        </span>
                </div>
            </div>
            <div class="mt-3">
                <button class="btn btn-primary mt-2 mb-2" id="btnCopyError">Copy Error</button>
                <div class="bg-base text-black p-4 border-1 rounded-md overflow-x-auto">
                    <pre id="errors" class="font-mono text-sm whitespace-pre pl-4"></pre>
                </div>

            </div>
            <div class="modal-action">
                <button type="button" class="btn" onclick="errorModal.close()">Close</button>
            </div>
        </div>
    </dialog>

    <dialog id="helpModal" class="modal">
        <div class="modal-box relative">
            <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2"
                onclick="helpModal.close()">✕</button>
            <div class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z" />
                </svg>
                <h2 class="ml-1 font-bold text-lg">Help</h2>
            </div>
            <div class="mt-3">
                <p>Follow the below steps to get started:</p>
                <ol class="list-decimal pl-8">
                    <li>Obtain API ID and Key from RCRAInfo</li>
                    <li>Add the API ID and Key under API Settings in this application</li>
                    <li>Download the Excel data template from
                        <span class="gh-link link  inline-flex items-center"><span>GitHub </span>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="size-4">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
                            </svg>
                        </span>
                    </li>
                    <li>Export data from source system and populate in Excel template ensuring it meets data
                        specifications</li>
                    <li>Select the spreadsheet and submit data to create manifests</li>
                </ol>
                <br>
                <p>Access <span class="gh-link link  inline-flex items-center"><span>GitHub </span>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="size-4">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
                        </svg>
                    </span> site for additional help content.</p>
            </div>
            <div class="modal-action">
                <button type="button" class="btn" onclick="helpModal.close()">Close</button>
            </div>
    </dialog>


    <div id="appToast" class="toast toast-end fixed hidden z-[5000]">
        <div class="alert alert-info" id="appToastBody">
        </div>
    </div>

    <script type="module" src="./renderer.js"></script>
</body>

</html>